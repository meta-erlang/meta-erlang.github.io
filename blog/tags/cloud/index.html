<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">2 posts tagged with &quot;cloud&quot; | meta-erlang</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://meta-erlang.github.io/blog/tags/cloud/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="erlang, elixir, yocto"><meta data-rh="true" property="og:title" content="2 posts tagged with &quot;cloud&quot; | meta-erlang"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://meta-erlang.github.io/blog/tags/cloud/"><link data-rh="true" rel="alternate" href="https://meta-erlang.github.io/blog/tags/cloud/" hreflang="en"><link data-rh="true" rel="alternate" href="https://meta-erlang.github.io/blog/tags/cloud/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="meta-erlang RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="meta-erlang Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2N5Z9W349S"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2N5Z9W349S",{})</script><link rel="stylesheet" href="/assets/css/styles.2a75c3e2.css">
<link rel="preload" href="/assets/js/runtime~main.a3e22da8.js" as="script">
<link rel="preload" href="/assets/js/main.2222bda6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">meta-erlang</b></a><a class="navbar__item navbar__link" href="/docs/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/meta-erlang/meta-erlang" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/06/09/index/">New meta-erlang branch mickledore</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/05/07/index/">New Erlang releases 24.3.4.11, 25.3.2 and recipe updates</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/04/index/">meta-erlang on cloud II: building your own application</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/29/index/">meta-erlang on cloud I: EWAOL based</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/22/index/">New Erlang releases 24.3.4.8, 25.1.2.1, 25.2.1</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>2 posts tagged with &quot;cloud&quot;</h1><a href="/blog/tags/">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/02/04/index/">meta-erlang on cloud II: building your own application</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-02-04T00:00:00.000Z" itemprop="datePublished">February 4, 2023</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/joaohf" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/joaohf.png" alt="João Henrique Ferreira de Freitas"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/joaohf" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">João Henrique Ferreira de Freitas</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of meta-erlang</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="intro">Intro<a href="#intro" class="hash-link" aria-label="Direct link to Intro" title="Direct link to Intro">​</a></h2><p>The
<a href="/blog/2023/02/04/index/">meta-erlang on cloud II, build your own application</a>
post has shown the basic idea for how would be possible (and in fact it is
possible) to build a custom Linux distribution and run it on Graviton AWS
instances.</p><p>Now, it&#x27;s time to refactor out the previous result. Removing what are not
necessary in order to create a slim meta-erlang cloud ready image.</p><p>So, this post is more like a tutorial to reach two main targets:</p><ul><li>Explore a demo Yocto layer which shows the basic pieces to run a distro on
Graviton</li><li>Add <a href="https://livebook.dev/" target="_blank" rel="noopener noreferrer">livebook</a> to that image and try it on cloud. Why
not trying some GPU processing :)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="meta-axon-cloud-aware">meta-axon cloud aware<a href="#meta-axon-cloud-aware" class="hash-link" aria-label="Direct link to meta-axon cloud aware" title="Direct link to meta-axon cloud aware">​</a></h2><p><a href="https://github.com/meta-erlang/meta-axon" target="_blank" rel="noopener noreferrer">meta-axon</a> is my playground layer
focused on demonstrate how Erlang and Elixir applications could be integrated
with Yocto ecosystem. Until now, meta-axon has been tailored to run on embedded
devices (like raspberry pi). But, I&#x27;m also added, along side with the former
<a href="https://github.com/meta-erlang/meta-axon/conf/distro/axon.conf" target="_blank" rel="noopener noreferrer">axon-slim</a>, a
new distro called
<a href="https://github.com/meta-erlang/meta-axon/conf/distro/axon.conf" target="_blank" rel="noopener noreferrer">axon</a>. The axon
distro is focused on cloud, for the purpose of this tutorial AWS cloud.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>If you are new to the Yocto Project; remember some basic
<a href="https://docs.yoctoproject.org/overview-manual/concepts.html#yocto-project-concepts" target="_blank" rel="noopener noreferrer">concepts here</a>.</p></div></div><p>I also introduced a new image called
<a href="https://github.com/meta-erlang/meta-axon/recipes-extented/image/axon-image-cloud.bb" target="_blank" rel="noopener noreferrer">axon-image-cloud</a>
with all the pieces needed to run it on Graviton instances. This image relies on
systemd plus <a href="https://cloud-init.io/" target="_blank" rel="noopener noreferrer">cloud-init</a> scripts.</p><p>It is important to mention that to run images on Graviton it is necessary to add
two layer dependencies:</p><ul><li><a href="https://git.yoctoproject.org/git/meta-arm" target="_blank" rel="noopener noreferrer">meta-arm</a>, implementing a generic
ARM 64 bits machine</li><li><a href="https://git.yoctoproject.org/git/meta-virtualization" target="_blank" rel="noopener noreferrer">meta-virtualization</a>,
bringing cloud-init recipe</li></ul><p>The rest of the needed components are all provided by standard Yocto layers
(like: poky and meta-openembedded).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-instructions">Build instructions<a href="#build-instructions" class="hash-link" aria-label="Direct link to Build instructions" title="Direct link to Build instructions">​</a></h2><p>We want fast feedback and test the build results quickly. So here is the
procedure that will build an distro linux image with Erlang, Elixir and
<a href="https://livebook.dev/" target="_blank" rel="noopener noreferrer">livebook</a>:</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>I&#x27;m assuming a working Linux environment in order to run the below commands.</p></div></div><ol><li><p>Clone the meta-axon layer:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/meta-erlang/meta-axon.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> meta-axon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Install the <a href="https://kas.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">kas</a> tool to setup a
bitbake based project.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/siemens/kas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> kas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip3 </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Call kas tool to build everything:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kas build kas/machines/meta-erlang-graviton2-livebook.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The final image has been created in the deploy folder:
<em>tmp/deploy/images/generic-arm64</em>.</p></div></div></li><li><p>Run the script <em>create-ami.sh</em> to convert and upload a image made with Yocto
into AWS AMI. Use your s3 bucket and specific how much extra space you want:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/scripts/create-ami.sh </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">add your s3 bucket here</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>The script <em>create_ami.sh</em> may need a fix in order to find the correct place for
the <em>qemu-img</em> tool. Would be nice to have some sort of Yocto bbclass to
automatically convert and push the AMI image to AWS. But it is not the case yet.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="launching-ec2-instances">Launching EC2 instances<a href="#launching-ec2-instances" class="hash-link" aria-label="Direct link to Launching EC2 instances" title="Direct link to Launching EC2 instances">​</a></h2><p>After uploading the image, it&#x27;s time to lunch an EC2 instance like the
following:</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Remember to use a <em>Free Trial available</em> instance type. When I wrote this post,
the eligible tier was the t4g.small.</p></div></div><p><img loading="lazy" alt="alt Launching a new EC2 instance" src="/assets/images/ec2_instance-45d124b067baf388b3a23847fac8ffcb.jpg" title="Launching a new EC2 instance" width="1231" height="1123" class="img_ev3q"></p><p>And, finally here is it running:</p><p><img loading="lazy" alt="alt Running a new EC2 instance" src="/assets/images/ec2_running-542df8ebba53c7bdbb1d569cbbc58273.jpg" title="Running a new EC2 instance" width="2106" height="1098" class="img_ev3q"></p><p>Accessing the instance via ssh and login with the user <em>axon</em> should work as
expected. After all it is a normal Linux distro.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="results">Results<a href="#results" class="hash-link" aria-label="Direct link to Results" title="Direct link to Results">​</a></h2><p>The following two screenshots show the livebook instance up and running on
Graviton EC2 instance. It is pretty cool.</p><p>Just showing the <code>top</code> command to check all the running process:</p><p><img loading="lazy" alt="alt Livebook instance Graviton" src="/assets/images/livebook_instance-d8d9491feeea9877f643f9815f942441.jpg" title="Livebook instance on Graviton" width="2418" height="1018" class="img_ev3q"></p><p>And here is the livebook system dashboard to inspect some usage statistics, and
system information:</p><p><img loading="lazy" alt="alt Livebook dashboard on Graviton" src="/assets/images/livebook_dashboard-ed3c09ff8e37c01665a4d7b70131741a.jpg" title="Livebook dashboard on Graviton" width="1307" height="821" class="img_ev3q"></p><p>As you can see, it is running on ARM64, with JIT enable.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Now we are converging to create the basic building blocks for creating custom
Linux distribution based on Yocto Project that runs on Cloud.</p><p>That could be the perfect case for projects that need to take control on every
detail of the software stack. From linx kernel configuration, building flags,
software configuration flags, anything. It&#x27;s really flexible.</p><p>And for projects that relies on Erlang and Elixir, it is also amazing bringing
it to Cloud ecosystem.</p><p>The first blog part
<a href="/blog/2023/01/29/index/">meta-erlang on cloud I: EWAOL based</a> has introduced
what is possible to build. This blog post is more related to explore the
introduced idea into something feasible and aligned with meta-erlang purposes.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/meta-erlang/">meta-erlang</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cloud/">cloud</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/01/29/index/">meta-erlang on cloud I: EWAOL based</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-01-29T00:00:00.000Z" itemprop="datePublished">January 29, 2023</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/joaohf" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/joaohf.png" alt="João Henrique Ferreira de Freitas"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/joaohf" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">João Henrique Ferreira de Freitas</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of meta-erlang</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="intro">Intro<a href="#intro" class="hash-link" aria-label="Direct link to Intro" title="Direct link to Intro">​</a></h2><p>The <a href="https://www.yoctoproject.org/" target="_blank" rel="noopener noreferrer">Yocto Project</a> has been made to create
specific embedded Linux distributions. And still does a great job on this field
making it possible to run softwares in a range of target architectures.</p><p>But, the term <em>embedded Linux distribution</em> should be expanded a bit more; it&#x27;s
not only about creating tiny filesystem within cross-compiled software, scripts
and configurations targeting platforms with small footprint, CPU and memory
constraints.</p><p>We could do more, actually there are people using the not so newly but still new
ARM processors that runs on cloud environment. For sure the most famous one is
the
<a href="https://aws.amazon.com/ec2/graviton/" target="_blank" rel="noopener noreferrer">Graviton EC2 instances, on AWS cloud</a>.</p><p>Looking into these Graviton processors and Yocto Project, what would it be
possible ? Maybe running Yocto images on Graviton instances could be feasible
enough to run some workload. And what about adding Erlang/OTP and Elixir to that
mix ? Or running some advanced database or broker made with Erlang ?</p><p>That is exactly what we will try to experiment. In this first post about running
meta-erlang on cloud, we are going to look how it would be possible.</p><p>Actually there are folks whose made possible to run Yocto images on Graviton
instances. Technically is pretty simple and all bits and bytes have been
described in the blog post
<a href="https://aws.amazon.com/blogs/industries/building-an-automotive-embedded-linux-image-for-edge-using-arm-graviton-yocto-project-soafee/" target="_blank" rel="noopener noreferrer">Building an Automotive Embedded Linux Image for Edge and Cloud Using Arm-based Graviton Instances, Yocto Project, and SOAFEE</a>.
The companion repository also worth the reading
<a href="https://github.com/aws4embeddedlinux/meta-aws-ewaol" target="_blank" rel="noopener noreferrer">The meta-aws-ewaol repository</a>.</p><p>The idea that <!-- -->[1]<!-- --> brings is part of another idea related to Software-Defined
Vehicles through Cloud <!-- -->[2]<!-- --> which is very excited. These references also cites a
framework to build Edge Workloads <!-- -->[3]<!-- --> and in fact the EWAOL (Edge Workload
Abstraction and Orchestration Layer) was used as a base to produce the
<a href="https://github.com/aws4embeddedlinux/meta-aws-ewaol" target="_blank" rel="noopener noreferrer">meta-aws-ewaol</a> layer.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="putting-everything-together-first-experiment">Putting everything together, first experiment<a href="#putting-everything-together-first-experiment" class="hash-link" aria-label="Direct link to Putting everything together, first experiment" title="Direct link to Putting everything together, first experiment">​</a></h2><p>So, based on all what has been described so far and as a first experience, I&#x27;ve
tested meta-aws-ewaol setup and added meta-erlang into that. The aim was to run
<code>erl</code> and <code>iex</code> console on Graviton EC2 instances.</p><p>I had to make a few fixes on meta-aws-ewaol and pushed the results here:
<a href="https://github.com/joaohf/meta-aws-ewaol/tree/main-add-meta-erlang" target="_blank" rel="noopener noreferrer">meta-aws-ewaol with meta-erlang</a>.
The rest of this session is a small guide that I made in order to run our first
experiment.</p><p>With a ready Yocto environment, following the
<a href="https://github.com/joaohf/meta-aws-ewaol/tree/main-add-meta-erlang#building-ewaol" target="_blank" rel="noopener noreferrer">Building EWAOL</a>
session is enough to get the system built. It&#x27;s just Yocto, nothing more.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><ul><li>You can create a free AWS account. There are Graviton instances included in
the AWS free tier. It&#x27;s more than sufficient.</li><li>Bear in mind that you don&#x27;t need to be an AWS master but you will end up
spending some time learning how to create AWS services.</li></ul></div></div><p>The next step is to create and setup all the AWS infrastructure needed in order
to push the Yocto image as AWS AMI and start the Graviton Instance. Lucky, there
is a Cloud Formation template which performs the initial setup. The session
<a href="https://github.com/joaohf/meta-aws-ewaol/tree/main-add-meta-erlang#pre-requisites" target="_blank" rel="noopener noreferrer">Pre-requisites</a>
helps to clarify it.</p><p>Then, having the Yocto image and the basic AWS account in place. It&#x27;s time to
use
<a href="https://github.com/joaohf/meta-aws-ewaol/blob/main-add-meta-erlang/scripts/create-ami.sh" target="_blank" rel="noopener noreferrer">a special script</a>
to convert Yocto image to an AMI image. Most of the job is done by awscli
commands. There is nothing related to Yocto here. The session
<a href="https://github.com/joaohf/meta-aws-ewaol/tree/main-add-meta-erlang#creating-ami-from-image-file" target="_blank" rel="noopener noreferrer">Creating AMI from image file</a>
tells what is necessary to do.</p><p>Finally, the last part. After pushing the AMI image to the S3 bucket. The fun
part is to instantiate a Graviton instance (please refer to the session
<a href="https://github.com/joaohf/meta-aws-ewaol/tree/main-add-meta-erlang#launch-the-ec2-image-as-usual-using-your-newly-created-ami" target="_blank" rel="noopener noreferrer">Launch the EC2 Image as usual using your newly created AMI</a>)
an run the EWAOL based image and test how Erlang and Elixir looks like.</p><p>I&#x27;ve added two screenshots below just to have a taste of the final results:</p><p><img loading="lazy" alt="alt Erlang console" src="/assets/images/meta-erlang-gravitron-erl-74d44c9d063c73e6a3f61183f0bfcb5e.jpg" title="Erlang console" width="1229" height="988" class="img_ev3q"></p><p><img loading="lazy" alt="alt Elixir console" src="/assets/images/meta-erlang-gravitron-iex-96e0e9113e0029ca640a1e9d74e3eb94.jpg" title="Elixir console" width="1007" height="167" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>This first experiment has finished and I can conclude two main bullets:</p><ul><li>It is possible to build a Yocto image and run it on Graviton instances</li><li>meta-aws-ewaol is a great start point. And the EWAOL framework looks solid for
what it has been planned for.</li></ul><p>However, what I am looking for is to run a tiny image with just the necessary to
instantiate an ARM cloud instance running Erlang/Elixir. That is what the next
blog post will do:
<a href="/blog/2023/02/04/index/">meta-erlang on cloud II, build your own application</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2><ul><li>[1]<!-- -->:
<a href="https://aws.amazon.com/blogs/industries/building-an-automotive-embedded-linux-image-for-edge-using-arm-graviton-yocto-project-soafee/" target="_blank" rel="noopener noreferrer">Building an Automotive Embedded Linux Image for Edge and Cloud Using Arm-based Graviton Instances, Yocto Project, and SOAFEE</a></li><li>[2]<!-- -->:
<a href="https://armkeil.blob.core.windows.net/developer/Files/pdf/white-paper/arm-aws-edge-environmental-parity-wp.pdf" target="_blank" rel="noopener noreferrer">Accelerating Software-Defined Vehicles through Cloud-To-Vehicle Edge Environmental Parity</a></li><li>[3]<!-- -->:
<a href="https://ewaol.docs.arm.com/en/kirkstone-dev/index.html" target="_blank" rel="noopener noreferrer">Edge Workload Abstraction and Orchestration Layer (EWAOL) Documentation</a></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/meta-erlang/">meta-erlang</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cloud/">cloud</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://erlangforums.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Erlang Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://elixirforum.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Elixir Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://erlef.org/wg/embedded" target="_blank" rel="noopener noreferrer" class="footer__link-item">EEF Embedded Working Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/meta-erlang/meta-erlang" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 meta-erlang</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a3e22da8.js"></script>
<script src="/assets/js/main.2222bda6.js"></script>
</body>
</html>